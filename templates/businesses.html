{% extends "admin_base.html" %}

{% block content %}
<main id="main" class="main">
    <h1 class="page-title">HFP BUSINESSES | {{business_count}}</h1>

    <section style="overflow-x: auto;" class="overflow-auto">
        <table class="table-responsive" style="box-sizing:border-box; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
            <thead>
                <tr>
                    <th>S/N</th>
                    <th>Busineses Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Category</th>
                    <th>Block & Shop Num</th>
                    <th>Social Handles</th>
                    <th>Media</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
               {# <tr colspan="8">{{businesses}}</tr>#}
            {% if businesses %}
                {% for business in businesses %}
                <tr>
                    <td>{{loop.index}}</td>
                    <td>{{business.business_name}}</td>
                    <td>{{business.email}}</td>
                    <td>{{business.phone_number}}</td>
                    <td>{{business.category}}</td>
                    <td>{{business.block_num}} & {{business.shop_num}}</td>
                    <td>{{business.website_url or business.social_handles}}</td>
                    <td>{{business.media_url}}</td>
                    <td>{{business.description}}</td>
                    <td class="action-cell">
                        <a class="btn btn-danger" href="{{url_for('user.edit_business_media', business_id=business.id)}}">Media</a>
                        <a class="btn btn-danger" href="{{url_for('admin.delete_business', business_id=business.id)}}">Delete</a>
                        <form action="{{url_for('admin.update_business', business_id=business.id)}}"> 
                            <button type="submit" class="btn btn-success">Update</button></form>
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
            </tbody>
        </table>
    </section>

    
    <script>
        function confirmDelete(event) {
            if (!confirm('Are you sure you want to delete this record?')) {
                event.preventDefault();
            }
        }

        function toggleDropdown(event, dropdownId) {
            event.stopPropagation(); // Prevent click from bubbling up
            var dropdowns = document.querySelectorAll('.action-menu');
            dropdowns.forEach(function (menu) {
                if (menu.parentElement.id !== dropdownId) {
                    menu.style.display = 'none';
                }
            });

            var dropdown = document.getElementById(dropdownId);
            var menu = dropdown.querySelector('.action-menu');
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }

        // Close dropdown if clicked outside
        document.addEventListener('click', function (event) {
            var openDropdowns = document.querySelectorAll('.action-menu');
            openDropdowns.forEach(function (menu) {
                if (!menu.contains(event.target) && !menu.previousElementSibling.contains(event.target)) {
                    menu.style.display = 'none';
                }
            });
        });
    </script>
</main>
{% endblock %}